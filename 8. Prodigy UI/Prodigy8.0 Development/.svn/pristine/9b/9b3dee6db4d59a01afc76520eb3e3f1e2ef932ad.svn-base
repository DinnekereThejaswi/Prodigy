{"version":3,"sources":["E:/MagnaWeb-Angular8.0/node_modules/angular2-moment/time-ago.pipe.js"],"names":[],"mappings":"AAAA;;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BA8F8B,AAC0B;;;;;;;oWAEpC","file":"time-ago.pipe.js","sourcesContent":["\"use strict\";\r\n/* angular2-moment (c) 2015, 2016 Uri Shaked / MIT Licence */\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar core_1 = require(\"@angular/core\");\r\nvar moment = require(\"moment\");\r\n// under systemjs, moment is actually exported as the default export, so we account for that\r\nvar momentConstructor = moment.default || moment;\r\nvar TimeAgoPipe = /** @class */ (function () {\r\n    function TimeAgoPipe(cdRef, ngZone) {\r\n        this.cdRef = cdRef;\r\n        this.ngZone = ngZone;\r\n    }\r\n    TimeAgoPipe.prototype.transform = function (value, omitSuffix) {\r\n        if (this.hasChanged(value, omitSuffix)) {\r\n            this.lastTime = this.getTime(value);\r\n            this.lastValue = value;\r\n            this.lastOmitSuffix = omitSuffix;\r\n            this.lastLocale = this.getLocale(value);\r\n            this.removeTimer();\r\n            this.createTimer();\r\n            this.lastText = momentConstructor(value).from(momentConstructor(), omitSuffix);\r\n        }\r\n        else {\r\n            this.createTimer();\r\n        }\r\n        return this.lastText;\r\n    };\r\n    TimeAgoPipe.prototype.ngOnDestroy = function () {\r\n        this.removeTimer();\r\n    };\r\n    TimeAgoPipe.prototype.createTimer = function () {\r\n        var _this = this;\r\n        if (this.currentTimer) {\r\n            return;\r\n        }\r\n        var momentInstance = momentConstructor(this.lastValue);\r\n        var timeToUpdate = this.getSecondsUntilUpdate(momentInstance) * 1000;\r\n        this.currentTimer = this.ngZone.runOutsideAngular(function () {\r\n            if (typeof window !== 'undefined') {\r\n                return window.setTimeout(function () {\r\n                    _this.lastText = momentConstructor(_this.lastValue).from(momentConstructor(), _this.lastOmitSuffix);\r\n                    _this.currentTimer = null;\r\n                    _this.ngZone.run(function () { return _this.cdRef.markForCheck(); });\r\n                }, timeToUpdate);\r\n            }\r\n        });\r\n    };\r\n    TimeAgoPipe.prototype.removeTimer = function () {\r\n        if (this.currentTimer) {\r\n            window.clearTimeout(this.currentTimer);\r\n            this.currentTimer = null;\r\n        }\r\n    };\r\n    TimeAgoPipe.prototype.getSecondsUntilUpdate = function (momentInstance) {\r\n        var howOld = Math.abs(momentConstructor().diff(momentInstance, 'minute'));\r\n        if (howOld < 1) {\r\n            return 1;\r\n        }\r\n        else if (howOld < 60) {\r\n            return 30;\r\n        }\r\n        else if (howOld < 180) {\r\n            return 300;\r\n        }\r\n        else {\r\n            return 3600;\r\n        }\r\n    };\r\n    TimeAgoPipe.prototype.hasChanged = function (value, omitSuffix) {\r\n        return this.getTime(value) !== this.lastTime\r\n            || this.getLocale(value) !== this.lastLocale\r\n            || omitSuffix !== this.lastOmitSuffix;\r\n    };\r\n    TimeAgoPipe.prototype.getTime = function (value) {\r\n        if (moment.isDate(value)) {\r\n            return value.getTime();\r\n        }\r\n        else if (moment.isMoment(value)) {\r\n            return value.valueOf();\r\n        }\r\n        else {\r\n            return momentConstructor(value).valueOf();\r\n        }\r\n    };\r\n    TimeAgoPipe.prototype.getLocale = function (value) {\r\n        return moment.isMoment(value) ? value.locale() : null;\r\n    };\r\n    TimeAgoPipe = __decorate([\r\n        core_1.Pipe({ name: 'amTimeAgo', pure: false }),\r\n        __metadata(\"design:paramtypes\", [core_1.ChangeDetectorRef, core_1.NgZone])\r\n    ], TimeAgoPipe);\r\n    return TimeAgoPipe;\r\n}());\r\nexports.TimeAgoPipe = TimeAgoPipe;\r\n"]}