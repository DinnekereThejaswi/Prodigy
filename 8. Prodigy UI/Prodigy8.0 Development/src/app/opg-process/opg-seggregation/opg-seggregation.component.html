<div class="row">
    <div class="col-sm-8">

    </div>
    <div class="col-sm-4">
        <app-lastdocno [routerUrl]="routerUrl" style="color: brown; text-align: right; font-style: italic;">
        </app-lastdocno>
    </div>
</div>

<div class="card mb-0">
    <div class="card-body">
        <form [formGroup]="opgSeggregationHeaderForm" class="form-horizontal">
            <div class="row">
                <div class="col-sm-4">
                    <div class="form-group">
                        <label class="control-label" for="no">GS</label>
                        <select class="form-control" formControlName="GSCode" [(ngModel)]="opgSeggregation.GSCode">
                            <option [ngValue]="null">Select</option>
                            <option *ngFor="let _GSList of GSList" [value]="_GSList.gs_code">
                                {{_GSList.item_level1_name}} </option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <label class="control-label" for="no">Authorized By</label>
                        <select class="form-control" formControlName="SalesmanCode"
                            [(ngModel)]="opgSeggregation.SalesmanCode">
                            <option [ngValue]="null">Select</option>
                            <option *ngFor="let _salesman of SalesManList" [value]="_salesman.sal_code">
                                {{_salesman.CodeName}}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="text" class="form-control" bsDatepicker [bsConfig]="datePickerConfig"
                            [(ngModel)]="applicationDate" [ngModelOptions]="{standalone: true}" readonly
                            value="{{applicationDate | date:'dd/MM/yyyy' }}" disabled />
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="text" class="form-control" bsDatepicker [bsConfig]="datePickerConfig"
                            [(ngModel)]="opgSeggregation.FromDate" formControlName="FromDate" readonly
                            value="{{opgSeggregation.FromDate | date:'dd/MM/yyyy' }}" />
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <label>To Date</label>
                        <input type="text" class="form-control" bsDatepicker [bsConfig]="datePickerConfig"
                            [(ngModel)]="opgSeggregation.ToDate" formControlName="ToDate" readonly
                            value="{{opgSeggregation.ToDate | date:'dd/MM/yyyy' }}" />
                    </div>
                </div>
                <div class="col-sm-1">
                    <div class="form-group">
                        <br>
                        <button type="submit" (click)="Go()"
                            class="btn btn-success waves-effect waves-light btn-rounded btn-secondary">&nbsp;
                            Go</button>
                    </div>
                </div>
                <div class="col-sm-5">
                </div>
            </div>
        </form>
    </div>
</div>
<br>
<ng-container *ngIf="opgInvoiceDetails.length > '0'">
    <div id="accordian" class="accordion">
        <div class="card mb-0">
            <div class="card-header Pointer" href="#InvoiceDetails" (click)="ToggleInvoiceDetails()"
                [ngClass]="CollapseInvoiceDetailsTab ? 'collapsed' : ''"
                [attr.data-toggle]="CollapseInvoiceDetailsTab ? '':'collapse'"
                style="background-color: #fdfdfd; box-shadow: -1px 0px 2px 0px rgba(0, 0, 0, 0.36);color:black">
                <div class="row">
                    <div class="col-md-4 ">
                        <a class="card-title align-middle" style="color:#005BFF">
                            <i class="fal fa-hand-receiving fa-2x mr-2 align-middle"></i>
                            <span class="align-middle Pointer"><ins>OPG Invoice Details</ins></span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="InvoiceDetails" class="card-body collapse" [collapse]="CollapseInvoiceDetailsTab">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="topbar">
                                    <tr>
                                        <th>Bill No</th>
                                        <th>SNo</th>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>Gr.Wt</th>
                                        <th>St.Wt</th>
                                        <th>N.Wt</th>
                                    </tr>
                                </thead>
                                <tbody *ngFor="let _opgInvoiceDetails of opgInvoiceDetails;let i=index;">
                                    <tr>
                                        <td>{{_opgInvoiceDetails.BillNo}}</td>
                                        <td>{{_opgInvoiceDetails.SlNo}}</td>
                                        <td>{{_opgInvoiceDetails.ItemCode}}</td>
                                        <td>{{_opgInvoiceDetails.Qty}}</td>
                                        <td>{{_opgInvoiceDetails.GrossWt | number:'1.3-3'}}</td>
                                        <td>{{_opgInvoiceDetails.StoneWt | number:'1.3-3'}}</td>
                                        <td>{{_opgInvoiceDetails.NetWt | number:'1.3-3'}}</td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div id="accordian" class="accordion">
        <div class="card mb-0">
            <div class="card-header Pointer" href="#StoneDetails" (click)="ToggleStoneDetails()"
                [ngClass]="CollapseStoneDetailsTab ? 'collapsed' : ''"
                [attr.data-toggle]="CollapseStoneDetailsTab ? '':'collapse'"
                style="background-color: #fdfdfd; box-shadow: -1px 0px 2px 0px rgba(0, 0, 0, 0.36);color:black">
                <div class="row">
                    <div class="col-md-4 ">
                        <a class="card-title align-middle Pointer" style="color:#ff00dd">
                            <i class="fas fa-2x fa-gem mr-2 align-middle"></i>
                            <span class="align-middle Pointer"><ins>OPG Invoice Stone Details</ins></span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="StoneDetails" class="card-body collapse" [collapse]="CollapseStoneDetailsTab">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="topbar">
                                    <tr>
                                        <th>Bill No</th>
                                        <th>SNo</th>
                                        <th>GS</th>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>Carat</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="opgInvoiceDetails.length > 0">
                                    <tr *ngFor="let _opgStoneFinalDets of opgStoneFinalDets;let i=index;">
                                        <td>{{_opgStoneFinalDets.BillNo}}</td>
                                        <td>{{_opgStoneFinalDets.SlNo}}</td>
                                        <td>{{_opgStoneFinalDets.GS}}</td>
                                        <td>{{_opgStoneFinalDets.Name}}</td>
                                        <td>{{_opgStoneFinalDets.Qty}}</td>
                                        <td>{{_opgStoneFinalDets.Carrat}}</td>
                                        <td>{{_opgStoneFinalDets.Amount}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div id="accordian" class="accordion">
        <div class="card mb-0">
            <div class="card-header Pointer" href="#TotalDetails" (click)="ToggleTotalDetails()"
                [ngClass]="CollapseTotalDetailsTab ? 'collapsed' : ''"
                [attr.data-toggle]="CollapseTotalDetailsTab ? '':'collapse'"
                style="background-color: #fdfdfd; box-shadow: -1px 0px 2px 0px rgba(0, 0, 0, 0.36);color:black">
                <div class="row">
                    <div class="col-md-4 ">
                        <a class="card-title align-middle Pointer" style="color:#00BBD6" data-toggle="collapse"
                            href="#Orders">
                            <i class="far fa-rupee-sign fa-2x mr-2 align-middle"></i>
                            <span class="align-middle Pointer"><ins>OPG Total</ins></span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="TotalDetails" class="card-body collapse" [collapse]="CollapseTotalDetailsTab">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="topbar">
                                    <tr>
                                        <th>GS</th>
                                        <th>Gr.Wt</th>
                                        <th>St.Wt</th>
                                        <th>D.Cts</th>
                                        <th>N.Wt</th>
                                    </tr>
                                </thead>
                                <tbody *ngFor="let _Data of Totals;let i=index;">
                                    <tr>
                                        <td>{{this.name}}</td>
                                        <td>{{_Data.GrossWt}}</td>
                                        <td>{{_Data.StoneWt}}</td>
                                        <td>{{_Data.Dcts}}</td>
                                        <td>{{_Data.NetWt}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div id="accordian" class="accordion">
        <div class="card mb-0">
            <div class="card-header Pointer" href="#SeggragationDetails" (click)="ToggleSeggragationDetails()"
                [ngClass]="CollapseSeggragationDetailsTab ? 'collapsed' : ''"
                [attr.data-toggle]="CollapseSeggragationDetailsTab ? '':'collapse'"
                style="background-color: #fdfdfd; box-shadow: -1px 0px 2px 0px rgba(0, 0, 0, 0.36);color:black">
                <div class="row">
                    <div class="col-md-4 ">
                        <a class="card-title align-middle Pointer" style="color: #3F51B5;" href="#SalesReturn"
                            data-toggle="collapse">
                            <i class="fas fa-exchange-alt fa-2x mr-2 align-middle"></i>
                            <span class="align-middle Pointer"><ins>OPG Seggregation Details</ins></span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="SeggragationDetails" class="card-body collapse" [collapse]="CollapseSeggragationDetailsTab">
                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered" style="width: 1500px;">
                                <thead class="topbar">
                                    <tr>
                                        <th>GS</th>
                                        <th>Gr.Wt</th>
                                        <th>Stone Gs</th>
                                        <th>St.Wt</th>
                                        <th>Diamond Gs</th>
                                        <th>D.Cts</th>
                                        <th>N.Wt</th>
                                        <th>Purity%</th>
                                        <th>Pure.Wt</th>
                                        <th>Action</th>
                                        <th>
                                            <button
                                                class="btn waves-effect waves-light btn-rounded btn-outline-secondary pull-right"
                                                style="margin-top: 1.2rem !important;" (click)="add()"
                                                [disabled]="EnableAddRow">
                                                <i class="far fa-plus-circle"></i> Add</button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody *ngFor="let field of fieldArray; let i = index">
                                    <tr>
                                        <td>
                                            <select class="form-control mr-auto mt-2 mt-lg-0 CustomWidth150"
                                                [(ngModel)]="field.GSCode">
                                                <option [ngValue]="null" [disabled]="readonly[i]">Select</option>
                                                <option *ngFor="let _ItemGSList of ItemGSList"
                                                    [value]="_ItemGSList.Code" [disabled]="readonly[i]">
                                                    {{_ItemGSList.Name}} </option>
                                            </select>
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.GrossWeight" [readonly]="readonly[i]"
                                                (change)="calcNwtByGwt(i)" appNumbersOnly placeholder="0.00">
                                        </td>
                                        <td>
                                            <select class="form-control mr-auto mt-2 mt-lg-0 CustomWidth150"
                                                [(ngModel)]="field.StoneGSCode">
                                                <option [ngValue]="null" [disabled]="readonly[i]">Select</option>
                                                <option *ngFor="let _oldstone of oldstone" [value]="_oldstone.Code"
                                                    [disabled]="readonly[i]">
                                                    {{_oldstone.Name}} </option>
                                            </select>
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.StoneWeight" [readonly]="readonly[i]"
                                                (change)="calcNwtBySwt(i)" appNumbersOnly placeholder="0.00">
                                        </td>
                                        <td>
                                            <select class="form-control mr-auto mt-2 mt-lg-0 CustomWidth100"
                                                [(ngModel)]="field.DiamondGSCode">
                                                <option [ngValue]="null" [disabled]="readonly[i]">Select</option>
                                                <option *ngFor="let _olddiamond of olddiamond"
                                                    [value]="_olddiamond.Code" [disabled]="readonly[i]">
                                                    {{_olddiamond.Name}}
                                                </option>
                                            </select>
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.DiamondCaretWeight" [readonly]="readonly[i]"
                                                appNumbersOnly placeholder="0.00" (change)="calculateDMDweight(i)">
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.NetWt" readonly placeholder="0.00">
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.PurityPercent" [readonly]="readonly[i]"
                                                (change)="calcPurWt(i)" appNumbersOnly placeholder="0.00">
                                        </td>
                                        <td>
                                            <input class="form-control CustomWidth75" type="text"
                                                [(ngModel)]="field.PureWeight" readonly placeholder="0.00">
                                        </td>
                                        <td style="width: 10px;" colspan="2">
                                            <ng-container *ngIf="EnableEditDelbtn[i]">
                                                <button class="btn btn-danger btn-rounded" type="button"
                                                    (click)="deleteFieldValue(i)"><i class="fal fa-trash-alt"></i>
                                                    Delete</button>
                                            </ng-container>
                                            <ng-container *ngIf="EnableSaveCnlbtn[i]">
                                                <button class="btn btn-success btn-rounded" type="button"
                                                    (click)="saveDataFieldValue(i)"><i class="fal fa-save"></i>
                                                    Save</button>
                                                <button class="btn btn-warning btn-rounded" type="button"
                                                    (click)="cancelDataFieldValue(i)"><i
                                                        class="far fa-window-close"></i>
                                                    Cancel</button>
                                            </ng-container>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>
<br>
<div class="row" *ngIf="opgSeggregation.OPGSeparationInputLines.length > '0'">
    <div class="col-md-4">
        <button class="btn btn-outline-success waves-effect waves-light btn-rounded btn-outline-secondary "
            (click)="saveOPGSeggreation()">
            <i class="far fa-save"></i> Submit</button>
        <button class="btn btn-danger waves-effect waves-light btn-rounded btn-secondary" (click)="cancel()"
            type="button"><i class="far fa-window-close"></i>&nbsp;Cancel</button>
    </div>
</div>


<div class="row" style="display:block;margin: auto;width: 30%;">
    <div class="modal fade" id="OPGSeggregationTab" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 1400px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button"
                        class="btn btn-outline-success waves-effect waves-light btn-rounded btn-outline-secondary"
                        id="exampleModalLabel" (click)=printOPGSeggregation()><i class="fal fa-print"></i>
                        Print</button>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="cancel()">
                            <span aria-hidden="true">&times;</span>
                          </button>
                </div>
                <ng-container *ngIf="PrintTypeBasedOnConfig">
                    <div class="container invoice-box htmlPrint" id="print-closed-section"
                        style="max-width: 900px;border-width: 2em" *ngIf="PrintTypeBasedOnConfig.PrintType == 'RAW'">
                        <pre>{{OPGSeggregationPrint}}</pre>
                    </div>
                    <span *ngIf="PrintTypeBasedOnConfig.PrintType == 'HTML'">
                        <div id="DisplayOPGSeggregationData" class="center"
                            [innerHTML]='OPGSeggregationPrint | safeHtml'></div>
                    </span>
                </ng-container>
            </div>
        </div>
    </div>
</div>


<ng-container *ngIf="EnableSummary">
    <div class="row">
        <div class="col-lg-12 col-md-12">
            <div class="card">
                <div class="row">
                    <div class="col-12">
                        <div class="social-widget">
                            <div class="soc-header box-twitter" style="padding: 3px;">
                                <h3 class="text-white"> Summary</h3>
                            </div>
                            <div class="soc-content" *ngIf="SummaryModel">
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"> <b>{{SummaryModel.OpgTotalGwt | number : '1.2-3'}}</b>
                                    </h4>
                                    <h5 class="text-black">OPG Total Gwt</h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>{{SummaryModel.TotalDcts | number : '1.2-3'}}</b>
                                    </h4>
                                    <h5 class="text-black">Total D.Cts</h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>
                                            {{SummaryModel.totalSwt | number : '1.2-3'}}</b>
                                    </h4>
                                    <h5 class="text-black">Total Swt</h5>
                                </div>
                            </div>

                            <div class="soc-content">
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"> <b>
                                            {{ grossWT(fieldArray) | number : '1.2-3' }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color: brown;">Segregated Total Wt</h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>{{dcts(fieldArray) | number : '1.2-3' }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color: brown;">Segregated Total D.Cts</h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>
                                            {{stoneWt(fieldArray) | number : '1.2-3' }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color: brown;">Segregated Total Swt</h5>
                                </div>
                                <!-- <div class="col-3 b-r">
                                    <h4 class="font-medium"><b>
                                            0.00</b>
                                    </h4>
                                    <h5 class="text-black">Tolerance Gwt</h5>
                                </div> -->
                            </div>
                            <div class="soc-content">
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"> <b>{{ PendingWt | number : '1.2-3'
                                            }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color:#006400;">Pending Wt</h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>
                                            {{ PendingDcts | number : '1.2-3' }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color:#006400;">Pending D.Cts </h5>
                                </div>
                                <div class="col-4 b-r">
                                    <h4 class="font-medium"><b>{{ PendingSwt | number : '1.2-3' }}</b>
                                    </h4>
                                    <h5 class="text-black" style="color:#006400;">Pending Swt</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</ng-container>



<ng-container *ngIf="EnableJson">
    <pre>{{ SummaryModel | json}}
    
    </pre>
    <pre>
        {{opgSeggregation | json}}
    </pre>
    <pre> {{ opgSeggregationDetail | json }}</pre>
</ng-container>